---
import type { CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import PostPreview from "@/components/blog/PostPreview.astro";
import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";

// Posts
const MAX_POSTS = 5;
const allPosts = await getAllPosts();
const allPostsByDate = allPosts
	.sort(collectionDateSort)
	.slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Pinned Posts, set to a max of 3;
const MAX_PINNED_POSTS = 3;
const pinnedPosts = allPostsByDate.filter((p) => p.data.pinned).slice(0, MAX_PINNED_POSTS);
---

<PageLayout meta={{ title: "Writings" }}>
	<section>
		<div class="mb-12 flex items-center gap-3">
			<h1 class="title">Rabbit Holes</h1>
			<a class="text-accent" href="/rss.xml" target="_blank">
				<span class="sr-only">RSS feed</span>
				<Icon aria-hidden="true" class="h-6 w-6" focusable="false" name="tabler:rss" />
			</a>
		</div>
		<p class="prose">
			A broken clock is right twice a day. But if you just have one clock, it’s impossible to tell
			exactly when the clock is right. So it could be right at any moment. And that brings you to
			the crux of the conceptualization. What is time? Let's dive in...
		</p>
	</section>
	{
		pinnedPosts.length > 0 && (
			<section class="mt-16">
				<h2 class="title hover:text-accent mb-6 text-xl">
					<a href="/posts/">Pinned Posts</a>
				</h2>
				<ul class="space-y-4" role="list">
					{pinnedPosts.map((p) => (
						<li class="grid gap-1 sm:grid-cols-[auto_1fr]">
							<PostPreview post={p} />
						</li>
					))}
				</ul>
			</section>
		)
	}
	{
		allPostsByDate.length > 0 && (
			<section class="mt-16">
				<h2 class="title hover:text-accent mb-6 text-xl">
					<a href="/posts/">Posts</a>
				</h2>
				<ul class="space-y-4" role="list">
					{allPostsByDate.map((p) => (
						<li class="grid gap-1 sm:grid-cols-[auto_1fr]">
							<PostPreview post={p} />
						</li>
					))}
					<li class="grid gap-1 sm:grid-cols-[auto_1fr]">
						<div class="min-w-30" />
						<div>
							<a class="cactus-link" href="/posts/">
								View all <span aria-hidden="true">→</span>
								<span class="sr-only">blog posts</span>
							</a>
						</div>
					</li>
				</ul>
			</section>
		)
	}
</PageLayout>
